<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Notification Hub{% endblock %}</title>

  {% block head %}
  <style>
    :root {
      color-scheme: light dark;
      --bg: #0f172a;
      --card: #1e293b;
      --border: #334155;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --accent: #38bdf8;
      --danger: #ef4444;
      --shadow: 0 20px 70px -40px rgba(0,0,0,.75);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: grid;
      grid-template-rows: auto 1fr auto;
    }
    header, footer {
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
      background: color-mix(in srgb, var(--card) 70%, transparent);
    }
    footer { border-top: 1px solid var(--border); border-bottom: none; }
    main {
      display: flex;
      justify-content: center;
      padding: 32px 16px 48px;
    }
    .shell {
      width: min(900px, 100%);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      box-shadow: var(--shadow);
    }
    h1, h2, h3 {
      margin: 0 0 8px;
      font-weight: 700;
      letter-spacing: -0.01em;
    }
    p { margin: 0 0 16px; color: var(--muted); }
    form {
      display: grid;
      gap: 16px;
    }
    label {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-weight: 600;
      color: var(--text);
    }
    select, textarea, input[type="text"], input[type="email"], input[type="url"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: color-mix(in srgb, var(--bg) 70%, transparent);
      color: var(--text);
      font-size: 14px;
      transition: border-color .15s ease, box-shadow .15s ease;
    }
    select:focus, textarea:focus, input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 35%, transparent);
    }
    textarea { min-height: 120px; resize: vertical; }
    .row { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
    .muted { color: var(--muted); font-size: 13px; }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: color-mix(in srgb, var(--accent) 18%, transparent);
      color: var(--accent);
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      align-items: center;
    }
    button {
      border: none;
      border-radius: 10px;
      padding: 12px 18px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: transform .1s ease, box-shadow .15s ease, background-color .2s ease;
      background: linear-gradient(135deg, #0ea5e9, #22d3ee);
      color: #0b1222;
      box-shadow: 0 10px 40px -15px rgba(34, 211, 238, .8);
    }
    button:hover { transform: translateY(-1px); }
    button:active { transform: translateY(0); }
    .ghost {
      background: transparent;
      color: var(--muted);
      border: 1px solid var(--border);
      box-shadow: none;
    }
    .hidden { display: none !important; }
    .status {
      padding: 10px 12px;
      border-radius: 10px;
      background: color-mix(in srgb, var(--border) 60%, transparent);
      color: var(--muted);
      font-size: 13px;
      border: 1px dashed var(--border);
    }
    @media (max-width: 640px) {
      header, footer { padding: 14px 16px; }
      .shell { padding: 18px; }
    }
  </style>
  {% endblock %}

</head>
<body>
  <header>
    <div class="row" style="grid-template-columns: auto 1fr;">
      <div class="pill">Notification Hub</div>
      <div class="muted" style="text-align: right;">Единая отправка сообщений</div>
    </div>
  </header>

  <main>
    <div class="shell">
      {% block content %}
      <h1>Отправить уведомление</h1>
      <p>Введите сообщение и выберите, куда его доставить.</p>

      <form id="send-form" method="post" action="/send">
        <label>
          Сообщение
          <textarea name="message" id="message" placeholder="Напишите что угодно..." required></textarea>
          <span class="muted">Можно использовать простой текст или markdown.</span>
        </label>

        <div class="row">
          <label>
            Канал
            <select name="channel" id="channel" required>
              <option value="" disabled selected>Выберите канал</option>
              <option value="telegram">Telegram</option>
              <option value="email">Email</option>
              <option value="webhook">Webhook</option>
            </select>
            <span class="muted">Куда отправить сообщение?</span>
          </label>

          <label data-field="email" class="hidden">
            Email адрес
            <input type="email" name="email_to" id="email_to" placeholder="name@example.com">
            <span class="muted">Почтовый ящик получателя.</span>
          </label>

          <label data-field="telegram" class="hidden">
            Telegram аккаунт или chat ID
            <input type="text" name="telegram_to" id="telegram_to" placeholder="@username или chat ID">
            <span class="muted">Пользователь, группа или канал.</span>
            <span class="muted">Важно: пользователь должен начать диалог с ботом, чтобы получить сообщение.</span>
          </label>

          <label data-field="webhook" class="hidden">
            Webhook URL
            <input type="url" name="webhook_url" id="webhook_url" placeholder="https://example.com/webhook">
            <span class="muted">Доступная извне HTTPS-точка.</span>
          </label>
        </div>

        <div class="actions">
          <button type="reset" class="ghost">Сбросить</button>
          <button type="submit">Отправить</button>
        </div>

        <div class="status" id="status" aria-live="polite">
          Готово к отправке. Выберите канал, чтобы увидеть обязательные поля.
        </div>
      </form>
      {% endblock %}
    </div>
  </main>

  {% block scripts %}
  <script>
    (() => {
      const form = document.getElementById("send-form");
      const channel = document.getElementById("channel");
      const status = document.getElementById("status");
      const fieldMap = {
        email: document.querySelector('[data-field="email"]'),
        telegram: document.querySelector('[data-field="telegram"]'),
        webhook: document.querySelector('[data-field="webhook"]')
      };

      function updateFields() {
        const value = channel.value;
        Object.entries(fieldMap).forEach(([key, el]) => {
          const input = el.querySelector("input");
          const visible = key === value;
          el.classList.toggle("hidden", !visible);
          input.required = visible;
        });
        status.textContent = value
          ? `Канал выбран: ${value}. Заполните соответствующее поле.`
          : "Готово к отправке. Выберите канал, чтобы увидеть обязательные поля.";
      }

      function handleSubmit(event) {
        if (!channel.value) {
          status.textContent = "Пожалуйста, выберите канал перед отправкой.";
          status.style.color = "var(--danger)";
          event.preventDefault();
          return;
        }
        status.textContent = "Отправляем…";
        status.style.color = "var(--muted)";
      }

      channel.addEventListener("change", updateFields);
      form.addEventListener("submit", handleSubmit);
      form.addEventListener("reset", () => {
        setTimeout(() => {
          channel.value = "";
          updateFields();
          status.textContent = "Форма очищена. Выберите канал, чтобы продолжить.";
          status.style.color = "var(--muted)";
        }, 0);
      });

      updateFields();
    })();
  </script>
  {% endblock %}
</body>
</html>

